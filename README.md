# go-weather-mqtt

# Система мониторинга температуры

# Версия 2.0.0

Данная версия написана на Go взамен реализации на python:  http://gitlab.local.infomatix.tech/basic-kit/weather-mqtt-publisher

## Обзор
Проект **go-weather-mqtt** предназначен для мониторинга температуры снаружи и на борту в реальном времени с использованием API Open-Meteo. Скрипт получает текущие данные о погоде, рассчитывает температуру на борту с учетом смещения и публикует эти значения в топики MQTT.

## Начало на Go
### Установка Go SDK
Зайдите на сайт https://golang.org/doc/install и скачайте установочный файл для вашей операционной системы. Следуйте инструкциям на странице для установки Go. После установки вы сможете запускать и собирать приложения Go из командной строки.

## Быстрый запуск
Для быстрой компиляции и запуска приложения выполните команду:
```bash
go run main.go
```
Эта команда скомпилирует и выполнит приложение в одном шаге.

## Сборка
Если вы хотите создать исполняемый файл приложения, используйте команду:
* **Для Linux**
```bash
go build -o go-weather-mqtt
```
* **Для Windows**
```bash
go build -o go-weather-mqtt.exe
```

## Требования
* Go 1.20+
* Библиотека net/http для запросов к API
* Библиотека paho.mqtt.golang для коммуникации MQTT

## Установка библиотек

Установите необходимые библиотеки с помощью команды:
```bash
go get github.com/eclipse/paho.mqtt.golang
```

## Настройка

- В файле кода укажите широту и долготу для получения точных данных о погоде для вашего местоположения.
- Настройте адрес и порт брокера MQTT.

## Использование

Соберите и запустите программу с помощью команды:

```bash
go run main.go
```

Программа будет работать в бесконечном цикле, публикуя данные о температуре в топики MQTT каждый час.

## Топики MQTT

По умолчанию используемые топики:
- температура за бортом **temperature/CurrentOutdoor**
- температура на борту **temperature/CurrentIndoor**

## Автозапуск

Чтобы программа запускалась автоматически, создайте systemd-службу:
1. Добавьте файл **weather-mqtt.service** в директорию /etc/systemd/system/ и укажите путь к исполняемому файлу приложения.
2. Убедитесь, что исполняемый файл программы доступен и имеет соответствующие права:
```bash
sudo chmod +x go-weather-mqtt
```
3. Обновите список служб systemctl:
```bash
sudo systemctl daemon-reload
```
4. Активируйте и запустите эту службу:
```bash
sudo systemctl enable weather-mqtt
sudo systemctl start weather-mqtt
```
5. Проверьте состояние службы:
```bash
sudo systemctl status weather-mqtt
```
